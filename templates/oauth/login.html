<script type="text/javascript">
    function login() {
        $.ajax({
            type: "POST",//方法类型
            url: "/",//url
            dataType: "HTML",
            data: $('#login').serialize(),
            success: function (data) {
                $("#pull-login").html(data);
            },
            error: function (data) {
                console.log(data);
            }
        });
    }
</script>

<div class="pull-right" id="pull-login">
    {% if request.session.username|default:'' == '' %}
        <i class="fa fa-power-off"></i>
        <a data-toggle="modal" data-target="#myModal">登录</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <i class="fa fa-user-plus"></i>
        <a href="{% url 'accounts:register' %}?next={{ request.path }}">注册</a>
    {% else %}
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-user"></i>
        <a href="/">投稿</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-user-circle-o" aria-hidden="true"></i>
        <a href="{% url 'accounts:profile' %}?next={{ request.path }}">{{ request.session.username }}</a>

        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-sign-out" aria-hidden="true"></i>
        <a href="{% url 'accounts:logout' %}?next={{ request.path }}">退出</a>
    {% endif %}

    <div class="{% if error %}modal fade in {% else %} modal fade {% endif %}" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="{% if error %}false{% else %} true {% endif %}" style="display: {% if error %}block{% else %}none{% endif %}">
        <div class="modal-dialog" style="width:550px;">
            <div class="modal-content">
                <!--  模态框的头 -->
                <div class="modal-header" style="background-color:#ffffff;">
                    {% if error %}
                        <a class="close" data-dismiss="modal" href="{% url 'blog:index' %}">×</a>
                    {% else %}
                        <button class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    {% endif %}
                    <h2 class="modal-title" id="myModalLabel" align="center">登录</h2>
                </div>
                <div class="modal-body" style="background-color:#ffffff;">
                    <!--   以下是登录的form表单 -->
                    <form class="form-horizontal" role="form" name="f" id="login" method="POST">
                        {% csrf_token %}
                        {{ test }}
                        {% if error %}
                            <div class="alert alert-block alert-danger">
                                <ul>
                                    <li>您提供的用户名或密码不正确。</li>
                                </ul>
                            </div>
                        {% endif %}
                        <div class="form-group" id="div1">
                            <label for="firstname" class="col-sm-2 control-label">用户名：</label>
                            <div class="col-sm-10" id="user">
                                <input type="text" class="form-control" id="name" placeholder="请输入名字"
                                       style="width:300px"
                                       name="username"
                                       class="tooltip-test"
                                       data-toggle="tooltip" data-placement="bottom"
                                       title="请输入6——8位的字母或数字任意组合"
                                       data-trigger="focus"
                                >
                                <label id="n" style="color: red;"></label>
                            </div>
                        </div>
                        <div class="form-group " id="div2">
                            <label for="lastname" class="col-sm-2 control-label">密 码：</label>
                            <div class="col-sm-10" id="pd">
                                <input type="password" class="form-control" id="pwd" placeholder="请输入密码"
                                       style="width: 300px" name="password"
                                       class="tooltip-test"
                                       data-toggle="tooltip" data-placement="bottom"
                                       title="请输入6位密码"
                                       data-trigger="focus"
                                >
                                <label id="p" style="color: red;"></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" name="remember">请记住我
                                    </label>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" name="next" value="{{ next_to }}"/>
                        <a class="secondaryAction" href="{% url 'accounts:register' %}">忘记密码了？</a>
                        <div class="login-title">
                            <span><a href="{% url 'accounts:register' %}">还没账号？去注册</a></span>
                        </div>
                        <a class="pull-right btn btn-info btn-sm rounded-0" onclick="login()">登录</a>
                    </form>
                </div>
                <div class="modal-footer" style="background-color:#ffffff;">
                </div>
            </div>
        </div>
    </div>
    {% if error %}
        <div class="modal-backdrop fade in"></div>
    {% endif %}
</div>